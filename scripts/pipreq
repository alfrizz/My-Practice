#!/usr/bin/env bash
set -euo pipefail

PROJECT="/mnt/g/My Drive/Ingegneria/Data Science GD/My-Practice"
REQS="$PROJECT/scripts/requirements.txt"
CONTAINER="gpu-jl"

for pkg in "$@"; do
  echo "üöÄ Installing '$pkg' in container‚Ä¶"
  if docker exec -u root "$CONTAINER" pip install --no-cache-dir "$pkg"; then
    name=$(docker exec "$CONTAINER" pip show "${pkg%%[=<>]*}" \
             | awk '/^Name:/ {print $2}')
    ver=$(docker exec "$CONTAINER" pip show "$name" \
             | awk '/^Version:/ {print $2}')
    line="$name==$ver"

    if ! grep -Fxq "$line" "$REQS"; then
      # ensure the file ends with a newline, then append
      tail -c1 "$REQS" | read -r _ || echo "" >> "$REQS"
      echo "$line" >> "$REQS"
      echo "‚úÖ Added '$line' to requirements.txt"
    else
      echo "‚ÑπÔ∏è  '$line' already in requirements.txt"
    fi
  else
    echo "‚ùå Failed to install '$pkg'; not touching requirements.txt"
  fi
done

# optional: sort/unique
sort -u "$REQS" -o "$REQS"
