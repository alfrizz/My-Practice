services:
  jupyter:
    container_name: gpu-jl

    build:
      context: ${HOME}/my_practice/scripts
      dockerfile: Dockerfile
    image: gpu-jl:latest

    restart: unless-stopped

    gpus: all
    cpus: "16.0"
    mem_limit: "28g"
    shm_size: 24g      # to fit num_workers × prefetch_factor × batch_size

    ports:
      - "8888:8888"

    volumes:        
      - "/mnt/c/Users/alfri/docker_tmp:/tmp"    # ← bind‐mount host dir for tmp (to free space: rm -rf ~/docker_tmp/*)
      - ${HOME}/my_practice:/workspace

    working_dir: /workspace

    entrypoint: ["/usr/local/bin/entrypoint.sh"]

    command:
      - jupyter
      - lab
      - --no-browser
      - --ip=0.0.0.0
      - --allow-root
      - --NotebookApp.token=
