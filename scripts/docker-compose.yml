services:
  jupyter:
    container_name: gpu-jl

    build:
      context: ${HOME}/my_practice/scripts
      dockerfile: Dockerfile
    image: gpu-jl:latest

    restart: unless-stopped

    gpus: all
    cpus: "16.0"
    mem_limit: "24g"
    shm_size: 16g      # to comfortably fit num_workers × prefetch_factor × batch_size

    ports:
      - "8888:8888"

    volumes:
      - ${HOME}/my_practice:/workspace

    working_dir: /workspace

    entrypoint: ["/usr/local/bin/entrypoint.sh"]

    command:
      - jupyter
      - lab
      - --no-browser
      - --ip=0.0.0.0
      - --allow-root
      - --NotebookApp.token=

    tmpfs:
      - /tmp:rw,size=300G
